# =================================================================== {{{
# This file contains the default startup commands for ranger.
# To change them, it is recommended to create either /etc/ranger/rc.conf(system-wide)
# or ~/.config/ranger/rc.conf (per user) and add your custom commands there.
#
# If you copy this whole file there, you may want to set the environment
# variable RANGER_LOAD_DEFAULT_RC to FALSE to avoid loading it twice.
#
# The purpose of this file is mainly to define keybindings and settings.
# For running more complex python code, please create a plugin in "plugins/" or
# a command in "commands.py".

# Flags give you a way to modify the behavior of the spawned process.
# They are used in the commands ":open_with" (key "r") and ":shell" (key "!").
# f   Fork the process, i.e. run in background. Please use this flag
#     instead of calling "disown" or "nohup", to avoid killing the
#     background command when pressing Ctrl+C in ranger.
# c   Run the current file only, instead of the selection
# r   Run application with root privilege (requires sudo)
# t   Run application in a new terminal window

# There are some additional flags that can currently be used only in the ":shell".
# p   Redirect output to the pager
# px  Redirect output to internal pager (commands.py|console.py/runner.py)
# pb  Redirect output to cmdline/statusbar with NOTIFY (runner.py)
# s   Silent mode.  Output will be discarded.
# l   Clear console before invoking command
# w   Wait for an Enter-press when the process is done

# By default, all the flags are off unless otherwise specified in rc.conf
# key bindings or rifle.conf rules. You can specify as many flags as you want.
# An uppercase flag negates the effect: "ffcccFsf" is equivalent to "cs".

# Open the console with the given command.
# console [-pN | -s sep | -x/X] <command>
# -pN    Set position at N index
# -s sep Set position at separator(any char[s] sequence), example '#'
# -x/X   Run execute_console instead of open_console to do f<any>/F<any>
# =================================================================== }}}

# Options Setting {{{
# miller: Use miller columns which show multiple levels of the hierarchy
# multipane: Midnight-commander like multipane view showing all tabs
set viewmode miller

# How many columns are there, and what are their relative widths?
set column_ratios 2,5,3

# Which files should be hidden? (regular expression)
set hidden_filter ^\.|^lost\+found$|\.pyo$|^__(py)?cache__$|^Desktop$|Syst.*Vol.*Info|RECYCLE.BIN|^3166-6338$|^d042.*7b20$|^sandisk_ex[pt]$|sogoupinyin|^google$|^snap$|downloadhelper|^华为手机助手

# Show hidden files? You can toggle this by typing 'zh'
set show_hidden false

# Valid values are "always", "never", "multiple" (default)
set confirm_on_delete always

# Use non-default path for file preview script?
set preview_script ~/.config/ranger/scope.sh

# Use the external preview script or display simple plain text or image previews?
set use_preview_script true

# Automatically count files in the directory, even before entering them?
set automatically_count_files true

# Open all images in this directory when running certain image viewers
set open_all_images true

# Be aware of version control systems and display information.
set vcs_aware false

# disabled, local (only show local info), enabled (show local and remote information).
set vcs_backend_git local
set vcs_backend_hg  disabled
set vcs_backend_bzr disabled
set vcs_backend_svn disabled

# Truncate the long commit messages to this length when shown in the statusbar.
set vcs_msg_length 50

# a plugin that adds file glyphs/icon support to Ranger:
default_linemode devicons

# Use one of the supported image preview protocols
set preview_images true

# Set the preview image method. Supported methods:
#
# * w3m (default):
#   Preview images in full color with the external command "w3mimgpreview"?
#   This requires the console web browser "w3m" and a supported terminal.
#
# * ueberzug:
#   Preview images in full color with the external command "ueberzug".
#   Images are shown by using a child window. Only for users who run X11.
set preview_images_method ueberzug

# Delay in seconds before displaying an image with the w3m method.
set w3m_delay 0.3

# Manually adjust the w3mimg offset when using a terminal which needs this
set w3m_offset 1

# Use a unicode "..." character to mark cut-off filenames?
set unicode_ellipsis true

# BIDI support - try to properly display file names in RTL languages (Hebrew, Arabic).
set bidi_support false

# Show dotfiles in the bookmark preview box?
set show_hidden_bookmarks true

# Which colorscheme to use for TUI/GUI mode?
eval fm.execute_console('set colorscheme alice') if os.getenv('DISPLAY') else fm.execute_console('set colorscheme chris')

# Preview files on the rightmost column?
set preview_files       false
set preview_directories true
set collapse_preview    true

# Save the console history on exit?
set save_console_history false

# Draw the status bar on top of the browser window (default: bottom)
set status_bar_on_top false

# Draw a progress bar in the status bar which displays the average state of all
set draw_progress_bar_in_status_bar true

# Draw borders around columns? (separators, outline, both, or none)
set draw_borders none
set draw_borders_multipane separators

# Display the directory name in tabs?
set dirname_in_tabs false

# Add the highlighted file to the path in the titlebar
set show_selection_in_titlebar true

# Enable the mouse support?
set mouse_enabled false

# Display the file size in the main column or status bar?
set display_size_in_main_column true
set display_size_in_status_bar  true

# Display the free disk space in the status bar?
set display_free_space_in_status_bar true

# Display the size of all files in the current directory?
set display_file_space_in_status_bar true

# Display files tags in all columns or only in main column?
set display_tags_in_all_columns false

# Set a title for the window?
set update_title false

# Set the title to "ranger" in the tmux program?
set update_tmux_title false

# Shorten the title if it gets long?  The number defines how many
# directories are displayed at once, 0 turns off this feature.
set shorten_title 3

# Show hostname in titlebar?
set hostname_in_titlebar true

# Abbreviate $HOME with ~ in the titlebar (first line) of ranger?
set tilde_in_titlebar true

# How many directory-changes or console-commands should be kept in history?
set max_history_size 32
set max_console_history_size 32

# Try to keep so much space between the top/bottom border when scrolling:
set scroll_offset 0

# Flush the input after each key hit?  (Noticeable when ranger lags)
set flushinput false

# Padding on the right when there's no preview?
set padding_right false

# Save bookmarks (used with mX and `X) instantly?
set autosave_bookmarks false

# Save the "`" bookmark to disk.
set save_backtick_bookmark false

# Update the size automatically by turning on this option:
set autoupdate_cumulative_size false

# Turning this on makes sense for screen readers:
set show_cursor false

# One of: size, natural, basename, atime, ctime, mtime, type, random
set sort natural

# Additional sorting options
set sort_reverse           false
set sort_case_insensitive  true
set sort_directories_first true
set sort_unicode           false

# Enable this if key combinations with the Alt Key don't work for you.
set xterm_alt_key false

# Whether to include bookmarks in cd command
set cd_bookmarks true

# Changes case sensitivity for the cd command tab completion
set cd_tab_case smart

# Use fuzzy tab completion with the "cd" command. For example,
# ":cd /u/lo/b<tab>" expands to ":cd /usr/local/bin".
set cd_tab_fuzzy true

# Avoid previewing files larger than this size(bytes). 0 to disable this feature.
set preview_max_size 0

# The key hint lists up to this size have their sublists expanded.
# Otherwise the submaps are replaced with "...".
set hint_collapse_threshold 32

# The delay that ranger idly waits for user input in milliseconds.
# Lower delay reduces lag between directory updates but increases CPU load.
set idle_delay 500

# When the metadata manager module looks for metadata, should it only look for
# a ".metadata.json" file in the current directory, or do a deep search and
# check all directories above the current one as well?
set metadata_deep_search false

# Clear all existing filters when leaving a directory
set clear_filters_on_dir_change false

# Possible values: false, absolute, relative.
set line_numbers relative

# When line_numbers=relative show the absolute line number in the current line.
set relative_current_zero false

# Start line numbers from 1 instead of 0
set one_indexed true

# Save tabs on exit
set save_tabs_on_exit false

# Enable scroll wrapping
set wrap_scroll false

# Whether or not to wrap long lines in the pager
set wrap_plaintext_previews true

# Set the global_inode_type_filter to nothing.
# Possible options: d, f and l for directories, files and symlinks.
set global_inode_type_filter

# This setting allows to freeze the list of files to save I/O bandwidth.
set freeze_files false

# Print file sizes in bytes instead of the default human-readable format.
set size_in_bytes false
set binary_size_prefix true

# Warn at startup if RANGER_LEVEL env var is greater than 0
set nested_ranger_warning true

# add by sim1 ++++++++++++++++++++++++++++++
set show_selection_dirname_in_titlebar false
set display_time_in_status_bar         false
set size_separator_space               false
set cd_after_mkdir                     true
set hint_max_count   32
set clipboard_prg_cli tmux show-buffer
set clipboard_prg_gui xsel -ob
# add by sim1 ------------------------------

# ===================================================================
# == Local Options
# ===================================================================
setlocal    path=~/vids/celeb      line_numbers absolute
setlocal    path=~/docs/webs       global_inode_type_filter f
setlocal    path=~/docs/misc       global_inode_type_filter f
setlocal    path=~/pics/combo      sort mtime
setlocal    path=~/pics/geohist    sort mtime
setlocal    path=~/pics/gifs       sort mtime
setlocal    path=~/pics/misc       sort mtime
setlocal    path=~/pics/preg       sort mtime
setlocal    path=~/pics/anime      sort mtime
setinregex  re=~/pics/celeb/*/     sort mtime
setinregex  re=~/pics/fave*        sort mtime
setinregex  re=~/misc/gits/*/*/    show_hidden=true
setlocal    path=/usr/local/.porn/pics/Graphis  show_selection_dirname_in_titlebar=true
# }}}

# Console/Command Aliases {{{
alias e              edit
alias q              quit
alias q!             quit!
alias qa             quitall
alias qa!            quitall!
alias qall           quitall
alias qall!          quitall!
alias setl           setlocal
alias del            delete
alias diff           open_with vimdiff %f %F

# scout flags: {{{
# -a  Automatically open a file on unambiguous match
# -e  Open the selected file when pressing enter
# -f  Filter files that match the current search pattern
# -g  Interpret pattern as a glob pattern
# -i  Ignore the letter case of the files
# -k  Keep the console open when changing a directory with the command
# -l  Letter skipping; e.g. allow "rdme" to match the file "readme"
# -m  Mark the matching files after pressing enter
# -M  Unmark the matching files after pressing enter
# -p  Permanent filter: hide non-matching files after pressing enter
# -r  Interpret pattern as a regular expression pattern
# -R  Reselect the old marked files
# -s  Smart case; like -i unless pattern contains upper case letters
# -t  Apply filter and search pattern as you type
# -v  Inverts the match
# }}}
alias filter         scout -fps
alias hide           scout -prsv
alias invfilter      scout -fpsv
alias find           scout -smrt
alias mark           scout -smr
alias unmark         scout -Mr
alias remark         scout -R  #another way to reselect
alias search         scout -fsp
alias travel         scout -apfiklst
alias find_inc       scout -ftsap
alias search_inc     scout -ftsap

alias cyankbasename  shell -s tmux setb "%s" &
alias cyankpathname  shell -s tmux setb %d &
alias cyankfullname  shell -s tmux setb %d/%f &
alias cyankrootname  shell -s echo -n %f | rev | cut -d\. -f2- | rev | tr -d '\n' | xargs -0 tmux setb &
alias xyankbasename  shell -s echo -n %s    | xclip -i -sel p -f | xclip -i -sel c &
alias xyankpathname  shell -s echo -n %d    | xclip -i -sel p -f | xclip -i -sel c &
alias xyankfullname  shell -s echo -n %d/%f | xclip -i -sel p -f | xclip -i -sel c &
alias xyankrootname  shell -s echo -n %f | rev | cut -d\. -f2- | rev | tr -d '\n' | xsel -i; xsel -o | xsel -b &
eval  fm.execute_console('alias yankbasename xyankbasename') if os.getenv('DISPLAY') else fm.execute_console('alias yankbasename cyankbasename')
eval  fm.execute_console('alias yankrootname xyankrootname') if os.getenv('DISPLAY') else fm.execute_console('alias yankrootname cyankrootname')
eval  fm.execute_console('alias yankpathname xyankpathname') if os.getenv('DISPLAY') else fm.execute_console('alias yankpathname cyankpathname')
eval  fm.execute_console('alias yankfullname xyankfullname') if os.getenv('DISPLAY') else fm.execute_console('alias yankfullname cyankfullname')

alias extract1       shell tsp atool -x %s
alias extract2       shell tsp atool -e -X %D %s
alias extract3       shell tsp atool -e -X %D/%f %f
alias extract4       shell tsp atool -D -e -X %D %s
alias archive1       shell set -- %s; tsp apack "$(echo "$1" | sed 's/\.[^.]*$//').zip" "$@"
alias archive2       shell set -- %s; tsp apack "$(echo "$1" | sed 's/\.[^.]*$//').7z" "$@"

alias diskusage      shell -px du --max-depth=1 -h --apparent-size | sort -rh
alias conv2pdf       shell name=$(echo %f | cut -f 1 -d '.') && pandoc %f -o $name.pdf && notify-send "%f converted to $name.pdf"

alias fzf_goto  fzf_exec "fd -L -a -t=f -t=l ."
alias fzf_auds  fzf_exec "fd -H -L -d=3 -t=f -e=mp3 -e=m4a . ~/auds"
alias fzf_porn  fzf_exec "fd -d=2 -t=f . /opt/.porn/text"
alias fzf_vids  fzf_exec "fd -H -L -d=3 -t=f -e=mp4 -e=webm -e=avi -e=mkv -e=rmvb . ~/vids"
alias fzf_webs  fzf_exec "fd -d=1 -t=f . ~/docs/webs"
# }}}

# Browser Keymaps--1 {{{
#source ~/.config/ranger/ranger-mpc

map <F1>    display_help
map <F3>    chain flat 2; console search_inc%space
map <F4>    exit
map <F5>    shell $SHELL

map <UP>       move up=1
map <DOWN>     move down=1
map <LEFT>     move left=1
map <RIGHT>    move right=1
map <HOME>     move to=0
map <END>      move to=-1
map <PAGEDOWN> move down=1 pages=True
map <PAGEUP>   move up=1   pages=True

map <backspace> tab_move -1
map <space>     tab_move 1
map <esc>       cancel_all

#<tab> = <c-i>
map <C-r>   reset
map <C-l>   chain reload_cwd; redraw_window
map <C-b>   toggle_flat
map <C-c>   eval fm.execute_console('echo Ctrl+C not defined!')
map <C-q>   console linemode%space
map <C-o>   history_go -1
map <C-i>   history_go 1
map <C-h>   tab_move 1 last=True
map <C-n>   tab_move 1
map <C-p>   tab_move -1
map <C-j>   move down=1 pages=True
map <C-k>   move up=1 pages=True
map <C-s>   eval fm.tab_new('%d')
map <C-t>   tab_new ~
map <C-u>   tab_restore
map <C-e>   fzf_edit
map <C-f>   fzf_fave
map <C-g>   fzf_goto
map <C-v>   fzf_vids
map <C-a>   fzf_auds
map <C-w>   fzf_webs
map <C-x>   fzf_porn
map <C-y>   console fzf_open%space

map <A-j>   chain tab_move 1; move down=1; tab_move -1
map <A-k>   chain tab_move 1; move down=-1; tab_move -1
map <a-1>   tab_open 1
map <a-2>   tab_open 2
map <a-3>   tab_open 3
map <a-4>   tab_open 4
map <a-5>   tab_open 5
map <a-6>   tab_open 6
map <a-7>   tab_open 7
map <a-8>   tab_open 8
map <a-9>   tab_open 9
map <a-r>   tab_shift +1
map <a-l>   tab_shift -1

map  ^   move to=0
map  $   move to=-1
map  @   shell $SHELL
map  !   console -p10 shell -px  %%s
map  &   shell -fs ./%f &
map  ~   cd ~
map  -   cd -
map  .   chain console; eval fm.ui.console.history_move(-1)
map g.   cd -r .
map  ?   chain draw_possible_programs; eval fm.open_console("open_with f ")
map  /   console search%space
map  =   console filter%space
map  :   console
map  ;   console
map  #   chain toggle_option line_numbers; reload_cwd
map  %   chain toggle_option size_zero_prefix; reload_cwd
map  *   set_rating_stars mode=+1
map g*   set_rating_stars mode=-1
map  <   tab_shift -1
map  >   tab_shift +1

# Filter stack
#map .d filter_stack add type d
#map .f filter_stack add type f
#map .l filter_stack add type l
#map .m console filter_stack add mime%space
#map .n console filter_stack add name%space
#map .# console filter_stack add hash%space
#map ." filter_stack add duplicate
#map .' filter_stack add unique
#map .| filter_stack add or
#map .& filter_stack add and
#map .! filter_stack add not
#map .r filter_stack rotate
#map .c filter_stack clear
#map .* filter_stack decompose
#map .p filter_stack pop
#map .. filter_stack show

# Marks
map  m<any>  set_bookmark   %any
map  '<any>  enter_bookmark %any
map  "<any>  unset_bookmark %any

# f<any> (%any does't work)
# https://github.com/ranger/ranger/issues/968
#eval for arg in "abcdefghijklmnopqrstuvwxyz": cmd("map f{0} chain move down=1; scout -s ^{0}; move up=1; move down=1".format(arg))
#eval for arg in "abcdefghijklmnopqrstuvwxyz": cmd("map F{0} chain move to=0; scout -s ^{0}; move down=1; move up=1".format(arg))
# customize "console" with -x in "commands.py" to no need input <enter> manually
map f<any> console -x scout -s ^%any
map F<any> console -X scout -s ^%any

# <space> related
map  b<space>  eval fm.execute_console('echo b<space> not defined!')
map  c<space>  eval fm.execute_console('echo c<space> not defined!')
map  f<space>  eval fm.execute_console('chain setlocal sort mtime; move to=0') if fm.settings.sort == 'natural' else fm.execute_console('setlocal sort natural')
map  g<space>  edit ~/.config/ranger/rc.conf
map  m<space>  eval fm.execute_console('echo m<space> not defined!')
map  o<space>  eval fm.execute_console('echo o<space> not defined!')
map  s<space>  eval fm.execute_console('chain setlocal sort size; move to=0') if fm.settings.sort == 'natural' else fm.execute_console('setlocal sort natural')
map  z<space>  toggle_option sort_reverse

# <enter> = <C-m> = <C-j> related
map  b<enter>  eval fm.execute_console('echo b<enter> not defined!')
map  c<enter>  eval fm.execute_console('echo c<enter> not defined!')
map  f<enter>  eval fm.execute_console('echo f<enter> not defined!')
map  g<enter>  eval fm.execute_console('echo g<enter> not defined!')
map  m<enter>  eval fm.execute_console('echo m<enter> not defined!')
map  o<enter>  eval fm.execute_console('echo o<enter> not defined!')
map  s<enter>  eval fm.execute_console('echo s<enter> not defined!')
map  z<enter>  eval fm.execute_console('echo z<enter> not defined!')

# <tab> related
map  b<tab>    eval fm.execute_console('echo b<tab> not defined!')
map  c<tab>    eval fm.execute_console('echo c<tab> not defined!')
map  f<tab>    eval fm.execute_console('echo f<tab> not defined!')
map  g<tab>    eval fm.execute_console('echo g<tab> not defined!')
map  m<tab>    eval fm.execute_console('echo m<tab> not defined!')
map  o<tab>    shell tmux split "watch tsp"
map  s<tab>    eval fm.execute_console('echo o<tab> not defined!')
map  z<tab>    eval fm.execute_console('echo z<tab> not defined!')

# mount ISO filesystem images (iso,nrg,bin,mdf,img): list, mount, unmount
# map bl  shell -p ls -1 /tmp/fuseiso
# map bm  shell mkdir -p /tmp/fuseiso && fuseiso -n -p %s "/tmp/fuseiso/%s"
# map bu  shell fusermount -u %s
# }}}

# Browser Keymaps--2 {{{
map  a   mark_files all=True toggle=True
map  A   chain toggle_option show_hidden; reset
map ga   get_cumulative_size
map  bb  draw_bookmarks
map  bh  display_help
map  bl  display_log
map  bm  mount
map  br  display_ratings
map  bt  taskview_open
map  cM  eval fm.cd('/media/' + os.getenv('USER'))
map  cd  console cd%space
map  cj  console z%space
map  cl  console relink%space
map  cm  console chmod%space
map  cs  console set colorscheme%space
map  ct  console -p18 shell touch -m -t  %%s
map  cw  console rename%space
map  cW  rename_append
map  co  chain copy; tab_move 1; paste; uncut; tab_move -1
map  ci  chain tab_move 1; copy; tab_move -1; paste; uncut
map  C   chain copy; paste; uncut; move down=1
map gc   edit ./.git/config
map  d   eval fm.execute_console('trash') if not fm.thisdir.path == os.getenv('TRASH_DIR') else fm.execute_console('delete')
map  D   delete
map  e   edit
map  E   shell vim %s
map ge   empty
map  G   move to=-1
map  gg  move to=0
map  h   move left=1
map  H   eval fm.move_top()
map  i   console touch%space
map gi   shell imgview -s
map zi   shell fzfimg
map  I   console mkdir%space
map gI   shell imgview -rs
map  j   move down=1
map bj   scroll_preview 3
map gj   chain move left=1; move down=1; move right=1
map oj   eval fm.scroll_preview(1, narg=fm.ui.browser.columns[-1].hei)
map sj   chain tab_move 1; move down=1; tab_move -1
map zj   jump_non -w
map  J   eval fm.scroll(+1)
map  k   move up=1
map bk   scroll_preview -3
map gk   chain move left=1; move up=1; move right=1
map ok   eval fm.scroll_preview(1, narg=-fm.ui.browser.columns[-1].hei)
map sk   chain tab_move 1; move down=-1; tab_move -1
map zk   jump_non -wr
map  K   eval fm.scroll(-1)
map  l   eval fm.execute_console('move right=1') if not '.mp3' in fm.thisfile.basename else fm.execute_console('shell -pb medinfo %f')
map gl   eval fm.execute_console('shell fileopen -b %f') if not fm.thisfile.is_link and not fm.thisfile.is_directory else fm.execute_console('cd -r %f')
map  L   eval fm.move_bot()
map gL   shell fileopen -B %f
map  mi  shell -pb medinfo %f
map  mI  shell -px medinfo -t
map  mj  eval fm.move_mid(+1)
map  mm  eval fm.move_mid(2)
map  mk  eval fm.move_mid(-1)
map gm   eval fm.move_mid(2)
map  M   eval fm.move_mid()
map gM   eval fm.move_mid(2)
map  n   search_next
map  N   search_next forward=False
map  od  filter_inode_type d
map  of  filter_inode_type f
map  ol  filter_inode_type l
map  or  filter_inode_type r
map  ot  filter_ext_type
map  oo  console filter%space
map  os  chain narrow; cancel_all
map  o.  eval fm.execute_console('filter ^.')
map  O   chain invfilter; filter_stack clear; narrow; filter_inode_type
map  p   chain paste; uncut
map gp   chain paste overwrite=True; uncut
map  P   paste move=True
map gP   paste move=True overwrite=True
map  q   eval fm.execute_console('chain quit; quit') if len(fm.tabs) == 2 else fm.execute_console('quit')
map  Q   quitall
map  r   eval fm.execute_console('bulkrename') if fm.thisdir.marked_items else fm.execute_console('rename_append -a')
map  R   eval fm.open_console('rename ' + fm.thisfile.basename)
map ,r   eval fm.open_console('rename ' + os.path.splitext(fm.thisfile.basename)[-1], position=7)
map ,r   rename_append -ar
map gr   console fzf_rga%space
map gR   eval fm.cd(ranger.RANGERDIR)
map  S   eval fm.open_console('subst ')
map gs   eval fm.open_console('mark ')
map  sa  eval fm.execute_console('mark ' + os.path.splitext(fm.thisfile.basename)[-1])
map  sc  eval fm.execute_console('shell cat %s > %f.html')
map  sC  console -s @# eval fm.execute_console('shell cat %s > @#')
map  sd  eval fm.execute_console('shell vimux -d %s') if fm.thisdir.marked_items else fm.execute_console('shell vimux -d %f %F')
map  sD  dircomp
map  se  shell sudoedit %f
map  sf  console find%space
map  sh  console set hint_max_count%space
map  si  cd %D
map  sl  chain copy; tab_move 1; paste_symlink relative=False; uncut
map  so  chain tab_move 1; cd %D; tab_move -1
map  sr  source ~/.config/ranger/rc.conf
map  ss  eval fm.execute_console('chain set viewmode multipane; default_linemode filename; set colorscheme lynna; set dirname_in_tabs true; reset; tab_move 1; tab_move 1') if fm.ui.viewmode == 'miller' else fm.execute_console('chain set viewmode miller; default_linemode devicons; set colorscheme chris; set dirname_in_tabs false; reset; tab_move 1; tab_move 1')
map  st  shell -px tree -F -L 2 --dirsfirst
map  sw  shell -s setwallpaper %f
map  sx  eval fm.execute_console('tab_shift +1') if fm.current_tab == 1 else fm.execute_console('tab_shift -1')
map  sy  chain paste_symlink relative=False; uncut
map  t   mark_files toggle=True
map gt   chain reselect; reload_cwd
map  T   mark_files toggle=True movedown=True narg=-1
map  u   uncut
map  v   display_file
map bv   eval fm.execute_console('chain set display_size_in_main_column!; set collapse_preview!; set preview_files!; set column_ratios=4,6') if fm.toggle_wide_mode() else fm.execute_console('chain set display_size_in_main_column!; set collapse_preview!; set preview_files!; set column_ratios=2,5,3')
map gv   chain reselect; reload_cwd
map  V   toggle_visual_mode
map  w   eval fm.execute_console('set column_ratios=6,4') if fm.toggle_wide_mode() else fm.execute_console('set column_ratios=2,5,3')
map  W   eval fm.execute_console('chain set preview_directories false; set column_ratios=6,4') if fm.toggle_very_wide_mode() else fm.execute_console('chain set preview_directories true; set column_ratios=2,5,3')
map  xo  chain cut; tab_move 1; paste; uncut; tab_move -1; reload_cwd
map  xi  chain tab_move 1; cut; tab_move -1; paste; uncut; tab_move 1; reload_cwd; tab_move -1
map  y   chain copy mode=toggle; move down=1
map  Y   chain yankbasename; cancel_all
map gy   yankrootname
map gY   yankpathname
map cy   chain cyankbasename; cancel_all
map cY   cyankpathname
map xy   chain xyankbasename; cancel_all
map xY   xyankpathname
map  ze  eval fm.execute_console('chain jump_non; move up=1') if fm.thisfile.is_directory else fm.execute_console('chain jump_non -r; move down=1')
map  zf  fzf_select
map  zt  eval fm.scroll_top()
map  zz  eval fm.scroll_mid()
map  zb  eval fm.scroll_bot()
map  z.  eval fm.execute_console('setlocal show_hidden true') if not fm.settings.show_hidden else fm.execute_console('setlocal show_hidden false')
map  Zn  chain set sort=basename; set sort_reverse=False
map  Zt  chain set sort=mtime;    set sort_reverse=False
map  ZN  chain set sort=natural;  set sort_reverse=False
map  ZT  chain set sort=type;     set sort_reverse=False
map  Zs  chain set sort=size;     set sort_reverse=False
map  Zh  set show_hidden!
map  Zc  set collapse_preview!
map  Zi  set preview_images!
map  Zf  set preview_files!
map  Zd  set preview_directories!
map  Zu  set autoupdate_cumulative_size!

# queue file with mpv, and watch list for task-spooler
map  ,m  shell tsp mpv --ontop --no-border --force-window --autofit=500x280 --geometry=-16-60 %s
map  ,w  shell tmux split "watch tsp"

#map  v   eval fm.execute_console('display_file') if not fm.thisfile.is_directory else fm.execute_console('shell -px tree -F -L 2 --dirsfirst %s')
#map  cp  shell -f echo -n %d/%f | xsel -i; xsel -o | xsel -i -b
#map  cf  shell -f echo -n %f    | xsel -i; xsel -o | xsel -i -b
#map  cd  shell -f echo -n %d    | xsel -i; xsel -o | xsel -i -b
#map  dgg eval fm.cut(dirarg=dict(to=0), narg=quantifier)
#map  dG  eval fm.cut(dirarg=dict(to=-1), narg=quantifier)
#map  dj  eval fm.cut(dirarg=dict(down=1), narg=quantifier)
#map  dk  eval fm.cut(dirarg=dict(up=1), narg=quantifier)
#map  ygg eval fm.copy(dirarg=dict(to=0), narg=quantifier)
#map  yG  eval fm.copy(dirarg=dict(to=-1), narg=quantifier)
#map  yj  eval fm.copy(dirarg=dict(down=1), narg=quantifier)
#map  yk  eval fm.copy(dirarg=dict(up=1), narg=quantifier)
#map  cw  eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"))
#map  cW  eval fm.open_console('rename ' + fm.thisfile.relative_path.replace("%", "%%"), position=7)

# Generate all the chmod bindings with some python help:
#eval for arg in "rwxXst": cmd("map +u{0} shell -f chmod u+{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map +g{0} shell -f chmod g+{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map +o{0} shell -f chmod o+{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map +a{0} shell -f chmod a+{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map +{0}  shell -f chmod +{0} %s".format(arg))
#
#eval for arg in "rwxXst": cmd("map -u{0} shell -f chmod u-{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map -g{0} shell -f chmod g-{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map -o{0} shell -f chmod o-{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map -a{0} shell -f chmod a-{0} %s".format(arg))
#eval for arg in "rwxXst": cmd("map -{0}  shell -f chmod -{0} %s".format(arg))
# }}}

# Command/Console Keymaps {{{
# Note: Unmapped keys are passed directly to the console.
cmap <tab>   eval fm.ui.console.tab()
cmap <s-tab> eval fm.ui.console.tab(-1)
cmap <ESC>   eval fm.ui.console.close()
cmap <CR>    eval fm.ui.console.execute()
cmap <C-l>   redraw_window

copycmap <ESC> <C-c>
copycmap <CR>  <C-j>

# Move around
cmap <up>    eval fm.ui.console.history_move(-1)
cmap <down>  eval fm.ui.console.history_move(1)
cmap <left>  eval fm.ui.console.move(left=1)
cmap <right> eval fm.ui.console.move(right=1)
cmap <home>  chain eval fm.ui.console.move(right=0, absolute=True); eval fm.ui.console.move_word(right=1)
cmap <end>   eval fm.ui.console.move(right=-1, absolute=True)
cmap <a-b>   eval fm.ui.console.move_word(left=1)
cmap <C-y>   eval fm.ui.console.move_word(left=1)
cmap <a-f>   eval fm.ui.console.move_word(right=1)
cmap <C-g>   eval fm.ui.console.move_word(right=1)

copycmap <a-b> <a-left>
copycmap <a-f> <a-right>

# Line Editing
cmap <backspace>  eval fm.ui.console.delete(-1)
cmap <delete>     eval fm.ui.console.delete(0)
cmap <C-w>        eval fm.ui.console.delete_word()
cmap <C-q>        eval fm.ui.console.delete_word(backward=False)
cmap <C-k>        eval fm.ui.console.delete_rest(1)
cmap <C-u>        eval fm.ui.console.delete_rest(-1)
cmap <C-v>        eval fm.ui.console.clipboard_paste()
cmap <C-x>f       eval fm.ui.console.paste(target='filename')
cmap <C-x>d       eval fm.ui.console.paste(target='dirpath')
cmap <C-x>x       eval fm.ui.console.paste(target='filename')
cmap <C-x>y       eval fm.ui.console.paste()

# And of course the emacs way
copycmap <up>        <C-p>
copycmap <down>      <C-n>
copycmap <left>      <C-b>
copycmap <right>     <C-f>
copycmap <home>      <C-a>
copycmap <end>       <C-e>
copycmap <delete>    <C-d>
copycmap <backspace> <C-h>

# Note: There are multiple ways to express backspaces.  <backspace> (code 263)
# and <backspace2> (code 127).  To be sure, use both.
copycmap <backspace> <backspace2>

# This special expression allows typing in numerals:
cmap <allow_quantifiers> false
# }}}

# Pager Keymaps {{{
pmap  <down>      pager_move  down=1
pmap  <up>        pager_move  up=1
pmap  <left>      pager_move  left=4
pmap  <right>     pager_move  right=4
pmap  <home>      pager_move  to=0
pmap  <end>       pager_move  to=-1
pmap  <pagedown>  pager_move  down=1.0  pages=True
pmap  <pageup>    pager_move  up=1.0    pages=True
pmap  <C-d>       pager_move  down=0.5  pages=True
pmap  <C-u>       pager_move  up=0.5    pages=True

pmap  J  chain pager_close; move down=1; display_file
pmap  K  chain pager_close; move up=1; display_file
pmap  w  chain set wrap_plaintext_previews!; redraw_window

#copypmap <LEFT>     h
copypmap <UP>       k
copypmap <DOWN>     j
copypmap <RIGHT>    l
copypmap <HOME>     g
copypmap <END>      G
copypmap <C-d>      d
copypmap <C-u>      u
copypmap <PAGEDOWN> n  f  <C-F>  <Space>  <c-j>
copypmap <PAGEUP>   p  b  <C-B>  <backspace>  <c-k>

# Basic
pmap       e   edit_file
pmap     <C-l> redraw_window
pmap     <ESC> pager_close
copypmap <ESC> q Q h v <C-c>
# }}}

# Taskview Keymaps {{{
tmap <up>        taskview_move up=1
tmap <down>      taskview_move down=1
tmap <home>      taskview_move to=0
tmap <end>       taskview_move to=-1
tmap <pagedown>  taskview_move down=1.0  pages=True
tmap <pageup>    taskview_move up=1.0    pages=True
tmap <C-d>       taskview_move down=0.5  pages=True
tmap <C-u>       taskview_move up=0.5    pages=True

copytmap <UP>       k  <C-p>
copytmap <DOWN>     j  <C-n> <CR>
copytmap <HOME>     g
copytmap <END>      G
copytmap <C-d>      d
copytmap <C-u>      u
copytmap <PAGEDOWN> n  f  <C-F>  <Space>  <c-j>
copytmap <PAGEUP>   p  b  <C-B>  <backspace>  <c-k>

# Changing priority and deleting tasks
tmap J          eval -q fm.ui.taskview.task_move(-1)
tmap K          eval -q fm.ui.taskview.task_move(0)
tmap D          eval -q fm.ui.taskview.task_remove()
tmap <pagedown> eval -q fm.ui.taskview.task_move(-1)
tmap <pageup>   eval -q fm.ui.taskview.task_move(0)
tmap <delete>   eval -q fm.ui.taskview.task_remove()

# Basic
tmap <C-l> redraw_window
tmap <ESC> taskview_close
copytmap <ESC> q Q v <C-c>
# }}}

# vim: foldmethod=marker
