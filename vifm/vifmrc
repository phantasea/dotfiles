" mapping {{{
map  <left>   <nop>
map  <right>  <nop>
map  <up>     <nop>
map  <down>   <nop>

nnoremap  <F1>     :.!tty-clock -cBS -C 6<cr>
nnoremap  <F5>     :shell<cr>
nnoremap  <F10>    :diff<cr>
nnoremap  <F11>    :diffsamewin<cr>
nnoremap  <F12>    :.!cmatrix -abs -C cyan<cr>

nnoremap  <cr>     <nop>
nnoremap  <bs>     gh
mnoremap  <bs>     <c-b>
qnoremap  <space>  <tab>
mnoremap  <space>  <c-f>
nnoremap b<space>  :set scrollbind!<cr>
nnoremap c<space>  :change<cr>
nnoremap f<space>  :change<cr>
nnoremap g<space>  :edit $MYVIFMRC<cr>
nnoremap m<space>  :copen<cr>
nnoremap o<space>  :if &sort == '+iname' | set sort='-mtime,+iname' | else | set sort='+iname' | endif<cr>
nnoremap s<space>  :set nolaststatus!<cr>
                  \:if !&laststatus | highlight CmdLine ctermfg=white ctermbg=blue cterm=bold
                  \| else | highlight CmdLine ctermfg=yellow ctermbg=none cterm=bold | endif<cr>
nnoremap w<space>  :set lsview!<cr>
nnoremap x<space>  <c-w>x
nnoremap z<space>  j

nnoremap  <c-b>  :tree<cr>
cnoremap  <c-j>  <cr>
mnoremap  <c-j>  <c-f>
nnoremap  <c-j>  <c-f>L
qnoremap  <c-j>  <c-f>
nnoremap  <c-k>  <c-b>H
mnoremap  <c-k>  <c-b>
qnoremap  <c-k>  <c-b>
cnoremap  <c-l>  <c-x>
nnoremap  <c-n>  gt
qnoremap  <c-n>  gt
vnoremap  <c-n>  gt
cnoremap  <c-o>  <s-tab>
nnoremap  <c-p>  gT
qnoremap  <c-p>  gT
vnoremap  <c-p>  gT
cnoremap  <c-r>  <c-x>
nnoremap  <c-r>  :restore<cr>
nnoremap  <c-t>  :tabnew<cr>
qnoremap  <c-t>  :tabnew<cr>
vnoremap  <c-t>  :tabnew<cr>
nnoremap  <c-v>  <s-tab>
qnoremap  <c-v>  <s-tab>
cnoremap  <c-w>  <a-b><a-d>

nnoremap  0  gg
nnoremap  ^  gg
nnoremap  $  G
nnoremap  ~  :tabnew ~<cr>
vnoremap  .  :!!<cr>
nnoremap  -  :invert s<cr>
vnoremap  -  :invert s<cr>
nnoremap  a  GVgg
vnoremap  a  ggoG
nnoremap  A  za
nnoremap gc  :change<cr>
nnoremap  cc :change<cr>
nnoremap  cd :cd<space>
nnoremap  cs :cds/
nnoremap  cg :goto<space>
nnoremap  cm cp
vnoremap  cm cp
nnoremap  ci :copyfromother<cr>
vnoremap  ci :copyfromother<cr>
nnoremap  co :copy<cr>
vnoremap  co :copytoother<cr>
nnoremap  cI :sucopyfromother<cr>
vnoremap  cI :sucopyfromother<cr>
nnoremap  cO :sucopytoother<cr>
vnoremap  cO :sucopytoother<cr>
nnoremap  d  dd
nnoremap  D  DD
nnoremap ge  :empty<cr>
nnoremap  e  :edit %c<cr>
qnoremap  e  q:edit %c<cr>
nnoremap  E  :sued<cr>
nnoremap \f  :file<cr>
mnoremap  h  q
nnoremap gi  :imgall<cr>
nnoremap gI  :rimgall<cr>
nnoremap  i  :touch<space>
nnoremap  I  :mkdir! ""<left><c-x>c
nnoremap gj  :siblnext<cr>
nnoremap  J  <c-e>
mnoremap  J  <c-e>
nnoremap gk  :siblprev<cr>
nnoremap  K  <c-y>
mnoremap  K  <c-y>
qnoremap  J  qje:if isactive('preview') | switch | endif<cr>
qnoremap  K  qke:if isactive('preview') | switch | endif<cr>
nnoremap gl  gf
nnoremap  oo =
nnoremap  of zd
nnoremap  od zD
nnoremap  o. zA
nnoremap  O  zR
qnoremap  p  <c-b>
nnoremap  q  ZZ
nnoremap  Q  :qall<cr>
nnoremap gr  :grep<space>
vnoremap  r  cw
nnoremap  r  cw
nnoremap  R  :rename<cr>
qnoremap  s  <c-w>
nnoremap  s  <c-w>
nnoremap  sd :if selfiles() != 2 | diff | else | diffsamewin | endif<cr>
vnoremap  sd :if selfiles() != 2 | diff | else | diffsamewin | endif<cr>
nnoremap  sf :find . -name "*"<cr>B
nnoremap  sl :alink!<cr>
nnoremap  sq :hideui<cr>
nnoremap  sr :source ~/.vifm/vifmrc<cr>
nnoremap  ss <c-w>S
nnoremap  st :tree<cr>
nnoremap  sy :sync<cr>
nnoremap gs  :sort<cr>
nnoremap  S  :%s//g<left><left>
vnoremap  S  :%s//g<left><left>
nnoremap \t  :lstrash<cr>
nnoremap gt  gs
nnoremap  t  tj
nnoremap  T  kt
nnoremap \u  :undolist<cr>
nnoremap  U  <c-r>
qnoremap  v  q
nnoremap  W  :set lsview!<cr>
nnoremap  xi :movefromother<cr>
vnoremap  xi :movefromother<cr>
nnoremap  xo :move<cr>
vnoremap  xo :movetoother<cr>
nnoremap  xI :sumovefromother<cr>
vnoremap  xI :sumovefromother<cr>
nnoremap  xO :sumovetoother<cr>
vnoremap  xO :sumovetoother<cr>
nnoremap  y  yy
nnoremap  Y  :copybasename<cr>
nnoremap gy  :copyfullname<cr>
"nnoremap v  :if !layoutis('only') | view | else | explore | endif<cr>
" }}}

" cabbrev {{{
cabbrev  mf  <c-x>m
cabbrev  fn  <c-x>c
cabbrev  dn  <c-x>d
cabbrev  fno <c-x><c-x>c
cabbrev  dno <c-x><c-x>d
cabbrev  cs  colorscheme
" }}}

" mark {{{
mark a /opt/apps
mark c /opt/conf
mark e /opt/conf
mark h ~/
mark n ~/docs/note
mark o /opt
mark p /opt/.priv
mark r /
mark t ~/.Trash
mark u /opt/util
mark v ~/.vim
mark w ~/docs/webs

mark M /media/simone
mark P /opt/.porn
mark T /tmp
mark U /media/simone/sandisk_u
mark V /media/simone/sandisk_v
mark W /media/simone/sandisk_w

bmark! ~/docs doc
" }}}

" option {{{
" This is the actual command used to start vi.  The default is vim.
set vicmd="vimux"
set vixcmd="vim"

" IO options
set syscalls
set iooptions=fastfilecloning

" TUI options
set notitle
set nolsview
set millerview
set laststatus
set tuioptions=""
set tabscope=pane
set showtabline=multiple
set dotdirs=rootparent
set fillchars=vborder:\|
set timefmt="%H:%M\ %m/%d/%y"
set numberwidth=1
set rulerformat="%=%l%%%S +%0-"
set viewcolumns=-{name},{rating},17{mtime}
set sizefmt=units:iec,precision:1
set milleroptions=lsize:2,csize:5,rsize:3
set tabstop=4
set confirm=permdelete
set dirsize=nitems
set shortmess="T"
set timeoutlen=2000
set cpoptions="s"
set caseoptions="pg"
set grepprg='ag --line-numbers %i %a %s'
set prefervsplit

let $VIFMRC_HAS_RICH_FONT = "TRUE"
if $DISPLAY == ""
  set classify="◘ :dir:,■ :reg:,Ξ :exe:,▥ :link:,▣ :char:,▩ :block:"
  set statusline="%5*[%A]%9*‥%6*%u:%g%9*‥%2*%d%9*‥%1*%a | %E%9*‥%4* %= %r \"%t%T\""
else
  set statusline="%5*[%A]%9* %6*%u:%g%9* %2*%d%9* %1*%a | %E%9* %4* %= %r \"%t%T\""

  if $VIFMRC_HAS_RICH_FONT == "FALSE"
    set classify="✠ :dir:,※ :reg:,♠ :exe:,♣ :link:,♡ :char:,◇ :block:"
  else
    set classify=' :dir:/, :exe:, :reg:, :link:'
    set classify+=' ::../::, ::*.sh::, ::*.[hc]pp,,*.cc,,*.hh::, ::*.[hc]::'
    set classify+=' ::/^copying|license$/::, ::.git/,,*.git/::/'
    set classify+=' ::*.epub,,*.fb2,,*.djvu::, ::*.pdf::'
    set classify+=' ::*.htm,,*.html,,**.[sx]html,,*.xml::'
    set classify+=' ::*.7z,,*.ace,,*.arj,,*.bz2,,*.cpio,,*.deb,,*.dz,,*.gz,,
                  \*.jar,,*.lzh,,*.lzma,,*.rar,,*.rpm,,*.rz,,*.tar,,*.taz,,
                  \*.tb2,,*.tbz,,*.tbz2,,*.tgz,,*.tlz,,*.trz,,*.txz,,*.tz,,
                  \*.tz2,,*.xz,,*.z,,*.zip,,*.zoo::'
    set classify+=' ::*.bmp,,*.gif,,*.jpeg,,*.jpg,,*.ico,,*.png,,*.ppm,,*.svg,,
                  \*.svgz,,*.tga,,*.tif,,*.tiff,,*.xbm,,*.xcf,,*.xpm,,*.xspf,,*.xwd::'
    set classify+=' ::*.aac,,*.anx,,*.asf,,*.au,,*.axa,,*.flac,,*.m2a,,*.m4a,,
                  \*.mid,,*.midi,,*.mp3,,*.mpc,,*.oga,,*.ogg,,*.ogx,,*.ra,,
                  \*.ram,,*.rm,,*.spx,,*.wav,,*.wma,,*.ac3::'
    set classify+=' ::*.avi,,*.ts,,*.axv,,*.divx,,*.m2v,,*.m4p,,*.m4v,,.mka,,
                  \*.mkv,,*.mov,,*.mp4,,*.flv,,*.mp4v,,*.mpeg,,*.mpg,,*.nuv,,
                  \*.ogv,,*.pbm,,*.pgm,,*.qt,,*.vob,,*.wmv,,*.xvid,,*.webm::'
    set classify+=' ::*.doc,,*.docx::, ::*.xls,,*.xls[mx]::'
    set classify+=' ::*.pptx,,*.ppt::'
  endif
endif

windo filter! /(lost\+found|Desktop|sandisk_win|sandisk_ext|sandisk_exp
              \|Extreme\ SSD|udisk_hama|3166-6338|d042e951-|华为手机助手)/

" Show list of matches on tab complition in command-line mode
set wildmenu
set wildstyle=popup

" Ignore case in search patterns unless it contains at least one uppercase letter
set ignorecase
set smartcase

" Highlight search, search while typing
set hlsearch
set incsearch
set wrapscan

" Try to leave some space from cursor to upper/lower border in lists
set scrolloff=0

" Trash Directory
set trash
set trashdir="~/.Trash"

" This is how many directories to store in the directory history.
set history=9

" Follow links on l or Enter.
set nofollowlinks
set nochaselinks

" With this option turned on you can run partially entered commands with
" unambiguous beginning using :! (e.g. :!Te instead of :!Terminal or :!Te<tab>).
set nofastrun

" Natural sort of (version) numbers within text.
set sortnumbers
set sort="+iname"

" Maximum number of changes that can be undone.
set undolevels=9

" If you installed the vim.txt help file set vimhelp.
" If would rather use a plain text help file set novimhelp.
set vimhelp

" If you would like to run an executable file when you
" press return on the file name set this.
set norunexec

" Use KiB, MiB, ... instead of KB, MB, ...
set noiec

" Display suggestions in normal, visual and view modes for keys, marks and
" registers (at most 5 files).  In other view, when available.
"set suggestoptions=normal,visual,view,otherpane,keys,marks,registers
set suggestoptions=normal,visual,view

" Selected color scheme
colorscheme chris

" The FUSE_HOME directory will be used as a root dir for all FUSE mounts.
" Unless it exists with write/exec permissions set, vifm will attempt to create it.
set fusehome=/tmp/vifm_FUSE

" Don't do too many requests to slow file systems
if !has('win')
  set slowfs=curlftpfs
endif
" }}}

" command {{{
" :com[mand] command_name action
" The following macros can be used in a command
" %a is replaced with the user arguments.
" %c the current file under the cursor.
" %C the current file under the cursor in the other directory.
" %f the current selected file, or files.
" %F the current selected file, or files in the other directory.
" %b same as %f %F.
" %d the current directory name.
" %D the other window directory name.
" %i completely ignore command output
" %m run the command in a menu window
" %S Show command output in the status bar
command! time  tty-clock -cBS -C 6
command! ss    cmatrix -abs -C cyan
command! sued  !sudoedit %c
command! surm  sudo rm -rf %c
command! rc    vimux ~/.vifm/vifmrc
command! df    df -h %m 2> /dev/null
command! ps    pstree %m
command! du    ncdu . 
command! diff  vimux -d %c %C
command! diffsamewin  vimux -d %f
command! uz    tar -zxf %c %i &
command! uj    tar -jxf %c %i &
command! zip   zip -r %f.zip %f
command! zx    zx %f
command! extract  aunpack %f &>/dev/null &
command! archive  apack %a %f &>/dev/null &
command! run   !! ./%f
command! make  !!make %a
command! mkcd  :mkdir %a | cd %a
command! md    mkdir -p %a
command! mv    mv -r %f %D
command! cp    cp -r %f %D
command! link  ln -s %d/%f %D
command! mkbt  mktorrent -p -a -o %D/%f.torrent %d%f
command! movetoother     mv -i %f %D %i &
command! copytoother     cp -R %f %D %i &
command! movefromother   mv -i %F %d %i &
command! copyfromother   cp -R %F %d %i &
command! sumovetoother   sudo mv -i %f %D %i
command! sucopytoother   sudo cp -R %f %D %i
command! sumovefromother sudo mv -i %F %d %i
command! sucopyfromother sudo cp -R %F %d %i
command! copybasename    tmux setb %c %i &
command! copyfullname    tmux setb %d/%c %i &
command! reload  :write | restart
command! iconv   iconv -f GBK -t UTF8 %c -o %c %i
command! vgrep   vim "+grep %a"
command! mpv     mpv --vo=drm %c
command! fim     fim %f > /dev/null 2>&1
command! imgall  imgview -s
command! rimgall imgview -rs
command! picpix  mediainfo %c | egrep '(Width|Height)' | awk -F ':' '{print $2}'
                 \ | sed 's/\ //g' | sed 's/pixels//g' | tr '\n' 'x' | sed 's/x$//' %S
" }}}

" autocommand {{{
"autocmd DirEnter '/opt/apps/**/*' setl previewprg='git log --color -- %c 2>&1'
autocmd DirEnter '~/pics' exec 'normal fm'
" }}}

" filetype and fileview {{{
" The file type is for the default programs to be used with a file extension.
" :filetype pattern1,pattern2 defaultprogram,program2
" :fileviewer pattern1,pattern2 consoleviewer
" The other programs for the file type can be accessed with the :file command
" The command macros %f, %F, %d, %F may be used in the commands.
" The %a macro is ignored.  To use a % you must put %%.

" For automated FUSE mounts, you must register an extension with :file[x]type
" in one of following formats:
"
" :filetype extensions FUSE_MOUNT|some_mount_command using %SOURCE_FILE and %DESTINATION_DIR variables
" %SOURCE_FILE and %DESTINATION_DIR are filled in by vifm at runtime.
" A sample line might look like this:
" :filetype *.zip,*.jar,*.war,*.ear FUSE_MOUNT|fuse-zip %SOURCE_FILE %DESTINATION_DIR
"
" :filetype extensions FUSE_MOUNT2|some_mount_command using %PARAM and %DESTINATION_DIR variables
" %PARAM and %DESTINATION_DIR are filled in by vifm at runtime.
" A sample line might look like this:
" :filetype *.ssh FUSE_MOUNT2|sshfs %PARAM %DESTINATION_DIR
" %PARAM value is filled from the first line of file (whole line).
" Example first line for SshMount filetype: root@127.0.0.1:/
"
" You can also add %CLEAR if you want to clear screen before running FUSE program.

" You can use filename modifiers after %c, %C, %f, %F, %b, %d and %D macros.  Supported modifiers are:
" :p - full path
" :~ - relative to the home directory
" :. - relative to current directory
" :h - head of the filename
" :t - tail of the filename
" :r - root of the filename (without last extension)

" Manpage
filetype  *.[1-8] man ./%c
fileview  *.[1-8] man ./%c | col -b

" Office files
fileview  *.doc  antiword %c, catdoc %c
fileview  *.docx docx2txt %c -
fileview  *.ppt  catppt %c
fileview  *.csv  sed "s/,,,,/,,-,,/g;s/,,/ /g" %c | column -t | sed "s/ - /  /g" | cut -c -%pw
if $DISPLAY == ""
  filetype  *.doc  vim %c
else
  filextype *.doc,*.docx,*.xls,*.xlsx,*.ppt,*.pptx  libreoffice %c &
endif

" tpp files
filetype  *.tpp  tpp %c

" c/c++ files
fileview  *.h,*.c,*.cpp  highlight -S c -O ansi -s dante %c

" xml files
fileview  *.xml  highlight -S xml -O ansi -s dante %c

" makefile
fileview  Makefile*,makefile*  highlight -S make -O ansi -s dante %c

" python files
fileview  *.py  highlight -S python -O ansi -s dante %c

" shell script
fileview  *.sh  highlight -S sh -O ansi -s dante %c

" Directories
fileview  */,.*/  tree -F -L 3 --dirsfirst %c

" Pdf
fileview  *.pdf  thumbnail %px %py %pw %ph %c, pdftotext -l 3 -nopgbrk -q %c -
if $DISPLAY == ""
  filetype  *.pdf fimgs %f
else
  filextype *.pdf zathura %c %i, apvlv %c
endif

" PostScript
fileview  *.ps ps2text %c -
if $DISPLAY == ""
  filetype  *.ps fimgs %c
else
  filextype *.ps,*.ps.gz zathura %c
endif

" Djvu
if $DISPLAY != ""
  filextype *.djvu zathura %c, apvlv %c
endif

" Audio
fileview  *.mp3,*.wav,*.flac,*.ogg,*.ape,*.wma  mediainfo %c
filetype  *.mp3,*.wav,*.flac,*.ogg,*.m4a        mpg123 -q %c > /dev/null 2>&1 &
filetype  *.wma,*.ape                           mplayer %c > /dev/null 2>&1 &

" Video
fileview  *.avi,*.mp4,*.wmv,*.3gp,*.ogv,*.mkv,*.mpg,*.vob,*.flv,*.rmvb,*.rmb,*.vdat,*.webm  
          \ thumbnail %px %py %pw %ph %c,
          \ mediainfo %c,
filetype  *.avi,*.mp4,*.wmv,*.3gp,*.ogv,*.mkv,*.mpg,*.vob,*.flv,*.rmvb,*.rmb,*.vdat,*.webm  vidmux %c

" Image
fileview  *.bmp,*.jpg,*.jpeg,*.png,*.gif,*.xpm,*.ppm  w3mimg %px %py %pw %ph %c
filetype  *.bmp,*.jpg,*.jpeg,*.png,*.gif,*.xpm,*.ppm  imgview %c

" Web
fileview  *.html,*.htm,*.xhtml,*.shtml  w3m -dump -cols 128 -T text/html %c
if $DISPLAY == ""
  filetype  *.html,*.htm,*.xhtml,*.shtml  wemux %c
else
  filextype *.html,*.htm,*.xhtml,*.shtml  firefox %c &
endif

" Markdown
fileview  *.md,*.mkd,*.markdown  pandoc -f markdown -t html %f | w3m -dump -cols 128 -T text/html

" Log
fileview  *.log  tac %c, tail -n500 %c
filetype  *.log  tac %c | less

" Object
fileview  *.o nm %c
filetype  *.o nm %c | less

" torrent
fileview  *.torrent  transmission-show %c

" PGP
fileview  *.asc  gpg --quiet --no-tty --no-use-agent --no-verbose -d %c
filetype  *.asc  !!gpg --verify %c

" FuseZipMount
fileview  *.zip,*.jar,*.war,*.ear  als %c
filetype  *.zip,*.jar,*.war,*.ear
       \ {Mount with fuse-zip}
       \ FUSE_MOUNT|fuse-zip %SOURCE_FILE %DESTINATION_DIR,
       \ {View contents}
       \ zip -sf %c | less,
       \ tar -xf %c,

" ArchiveMount
fileview  *.tar,*.tgz,*.tar.gz,*.tbz,*.tbz2,*.tar.bz2  als %c
filetype  *.tar,*.tgz,*.tar.gz,*.tbz,*.tbz2,*.tar.bz2
       \ {Mount with archivemount}
       \ FUSE_MOUNT|archivemount %SOURCE_FILE %DESTINATION_DIR,

" Fuse7z
fileview  *.7z  als %c, 7z | %c
filetype  *.7z
       \ {Mount with fuse-7z}
       \ FUSE_MOUNT|fuse-7z %SOURCE_FILE %DESTINATION_DIR,

" Rar2FsMount
fileview  *.rar  unrar v %c, als --option=use_rar_for_unpack=0 %c
filetype  *.rar
       \ {Mount with rar2fs}
       \ FUSE_MOUNT|rar2fs %SOURCE_FILE %DESTINATION_DIR,

" IsoMount
fileview  *.iso  isoinfo -l -i %c
filetype  *.iso
       \ {Mount with fuseiso}
       \ FUSE_MOUNT|fuseiso %SOURCE_FILE %DESTINATION_DIR,

" SshMount
filetype  *.ssh
       \ {Mount with sshfs}
       \ FUSE_MOUNT2|sshfs %PARAM %DESTINATION_DIR %FOREGROUND,

" FtpMount
filetype  *.ftp
       \ {Mount with curlftpfs}
       \ FUSE_MOUNT2|curlftpfs -o ftp_port=-,,disable_eprt %PARAM %DESTINATION_DIR %FOREGROUND,

" MD5
filetype *.md5
       \ {Check MD5 hash sum}
       \ md5sum -c %f %S,

" SHA1
filetype *.sha1
       \ {Check SHA1 hash sum}
       \ sha1sum -c %f %S,

" SHA256
filetype *.sha256
       \ {Check SHA256 hash sum}
       \ sha256sum -c %f %S,

" SHA512
filetype *.sha512
       \ {Check SHA512 hash sum}
       \ sha512sum -c %f %S,

" Windows EXE file
fileview *.exe  echo Windows binary file: no preview available. %i

" Misc
fileview  *.a,*.deb,*.alz,*.xz,*.txz,*.tZ,*.tzo,*.xpi  als %c

if $DISPLAY == "XXX"
  fileview *.pdf
      \ vifmimg pdfpreview %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear

  fileview *.epub
      \ vifmimg epubpreview %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear

  fileview *.avi,*.mp4,*.wmv,*.dat,*.3gp,*.ogv,*.mkv,*.mpg,*.mpeg,*.vob,
      \*.fl[icv],*.m2v,*.mov,*.webm,*.ts,*.mts,*.m4v,*.r[am],*.qt,*.divx,
      \ vifmimg videopreview %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear

  fileview *.bmp,*.jpg,*.jpeg,*.png,*.xpm
      \ vifmimg draw %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear

  fileview *.gif
      \ vifmimg gifpreview %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear

  fileview *.ico
      \ vifmimg magickpreview %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear
endif

" Open all other files with default system programs. By default all unknown files are opened with 'vi[x]cmd'
" if $DISPLAY == ""
"   filetype  * vimux %f
" else
"   filextype * vim %f
" endif
" }}}

" What should be saved automatically between vifm runs
set vifminfo=tui,chistory,dhistory,shistory,savedirs,ratings

