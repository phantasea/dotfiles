# vim: set ft=tmux :

unbind-key C-b
set-option -g prefix `
bind "'" send-prefix

# disable <ESC> working as meta-key
set -g escape-time 0

set -g pane-active-border-fg red
set -g pane-active-border-bg black
set -g pane-border-fg      white
set -g pane-border-bg      black
set -g allow-rename        off
set -g base-index          1
set -g status-interval     0
set -g display-time        1000
set -g mode-keys           vi
set -g status-keys         emacs
set -g status-position     top
set -g status              off

set -g status-left         '-#(date -d "today" +"%H:%M")-'
set -g status-right        '-#(date -d "today" +"%b %d, %a")-'
set -g status-left-fg      white
set -g status-left-bg      red
set -g status-right-fg     white
set -g status-right-bg     red
set -g status-bg           white
set -g status-fg           black
set -g status-justify      centre

setw -g window-status-bg         yellow
setw -g window-status-fg         black
setw -g window-status-current-bg green
setw -g window-status-current-fg black
setw -g window-status-last-bg    cyan
setw -g window-status-last-fg    black
setw -g mode-bg                  magenta
setw -g mode-fg                  black

setw -g clock-mode-colour        cyan
setw -g clock-mode-style         24
setw -g pane-base-index          1

bind tab    if-shell "x-is-run" "set-option status\; set status-position bottom" "set-option status\; set status-position top"
bind ,      run-shell -b "~/.util/musdo -p"
bind \;     run-shell -b "~/.util/musdo -n"
bind .      run-shell -b "~/.util/musdo -t"
bind '~'    run-shell "if ! x-is-run; then fbgrab ~/misc/snapshot-$(date +%Y%m%d%H%M%S).png; else scrot $HOME/misc/scrot_`date +%Y%m%d_%H%M%S`.jpg; fi"
bind >      run-shell -b "~/.util/autocd"
bind `      selectw -l
bind m      selectw -t:music
bind M      selectw -t:vidplay
bind enter  selectw -t:1
#bind bspace selectw -t:fzfmux
#bind space  if-shell "tmux selectw -t:9" "" 'if-shell "tmux selectw -t:0" "" "run-shell -b fmopen"'
#bind bspace if-shell "tmux selectw -t:0" "" 'if-shell "tmux selectw -t:9" "" "run-shell -b \"fmopen -b\""'
bind space  if-shell "tmux selectw -t:9" "" 'run-shell fmopen'
bind bspace if-shell "tmux selectw -t:0" "" 'run-shell -b "fmopen -b"'

#bind -n F4   run-shell -b "~/.util/mailopen"
#bind -n F6   run-shell -b "~/.util/musmux"
#bind -n F7   run-shell -b "~/.util/vimux ~/.vim/bookmarks"
#bind -n F8   run-shell -b "~/.util/webview"
#bind -n F9   run-shell -b "~/.util/fmopen"
#bind -n F10  run-shell -b "~/.util/fmopen -b"
#bind -n F12  new-window -n clock "tty-clock -cB -C 6"

bind -n 'M-tab'    select-window -n
bind -n 'DC'       new-window -n cmatrix\; send-keys 'cmatrix -ab -C cyan && tmux kill-window' 'Enter'
bind -n 'IC'       new-window -n clock  \; send-keys 'tty-clock -cB -C 6 && tmux kill-window'  'Enter'

bind    'F'        run-shell -b 'fzfmux fff'
bind    'A'        run-shell -b 'fzfmux ffa'
bind    'V'        run-shell -b 'fzfmux ffv'
bind    'W'        run-shell -b 'fzfmux ffw'
bind    'X'        run-shell -b 'fzfmux ffx'

bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."
bind R refresh-client

bind t clock-mode

bind w choose-window

bind s split-window -v
bind v split-window -h

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -r H resize-pane -L 1
bind -r L resize-pane -R 1
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2

bind U capture-pane -J \; save-buffer "/tmp/tmux-buffer" \; delete-buffer \; split-window -l 10 "urlview '/tmp/tmux-buffer'"
bind i copy-mode
bind o paste-buffer
bind u paste-buffer
bind y copy-mode \; send-key vey

# for tmux in Ubuntu 16.04
#bind -T vi-choice 'C-j'  choose
#bind -T vi-choice 'l'    choose
#bind -T vi-choice space  choose

#bind -t vi-copy   'v'    begin-selection
#bind -t vi-copy   'y'    copy-selection
#bind -t vi-copy   'C-v'  rectangle-toggle
#bind -t vi-copy   'C-j'  page-down
#bind -t vi-copy   'C-k'  page-up
#bind -t vi-copy   'H'    top-line
#bind -t vi-copy   'M'    middle-line
#bind -t vi-copy   'L'    bottom-line
#bind -t vi-copy   'J'    scroll-down
#bind -t vi-copy   'K'    scroll-up

# for tmux 2.6 in Ubuntu 20.04
bind -T copy-mode-vi 'v'   send -X begin-selection
bind -T copy-mode-vi 'y'   send -X copy-selection-and-cancel
bind -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind -T copy-mode-vi 'C-j' send -X page-down
bind -T copy-mode-vi 'C-k' send -X page-up
bind -T copy-mode-vi 'H'   send -X top-line
bind -T copy-mode-vi 'M'   send -X middle-line
bind -T copy-mode-vi 'L'   send -X bottom-line
bind -T copy-mode-vi 'J'   send -X scroll-down
bind -T copy-mode-vi 'K'   send -X scroll-up

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
#bind -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
#bind -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
#bind -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
#bind -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
#bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Hide and show window name from status line
#bind '-' setw window-status-format '#I'\; setw window-status-current-format '#I'
#bind '+' setw window-status-format '#I:#W#F'\; setw window-status-current-format '#I:#W#F'
